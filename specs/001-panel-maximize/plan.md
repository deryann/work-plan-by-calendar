# 實作計畫：面板最大化切換

**Branch**: `001-panel-maximize` | **Date**: 2025-10-24 | **Spec**: [spec.md](./spec.md)
**Input**: 功能規格來自 `/specs/001-panel-maximize/spec.md`

<!--
  語言要求：本實作計畫依據憲法原則 V 必須使用繁體中文 (zh-TW) 撰寫。
  技術術語可適當使用英文。
-->

**Note**: 本文件由 `/speckit.plan` 命令產生。

## 摘要

本功能允許使用者透過雙擊任一計畫面板（年/月/週/日）的標題列，將該面板最大化至佔據整個可用空間，同時隱藏其他面板。再次雙擊可恢復所有面板的正常顯示狀態。此功能採用純前端實作，不需要後端 API 支援，透過 CSS 類別切換和 JavaScript 事件處理來實現，最小化對現有程式碼的變更。

## 技術環境

**Language/Version**: Python 3.11+ (後端), ES6+ JavaScript (前端)
**Primary Dependencies**: 
  - 後端: FastAPI 0.104+, Pydantic, uvicorn
  - 前端: 無框架（Vanilla JS），TailwindCSS (CDN), Marked.js, Day.js
**Storage**: 檔案系統 (Markdown 檔案)
**Testing**: pytest (後端), 手動測試 (前端 - 本功能純前端實作)
**Target Platform**: Web 應用程式 (桌面瀏覽器、平板、手機)
**Project Type**: Web 應用程式 (backend + frontend 分離)
**Performance Goals**: 
  - 雙擊響應時間 < 200ms
  - 動畫效能 ≥ 50fps (在 60fps 裝置上)
  - 無視覺閃爍或狀態錯誤
**Constraints**: 
  - 必須與現有面板摺疊 (collapse) 功能相容
  - 必須保留所有面板內部狀態（編輯模式、內容、捲動位置）
  - 必須支援觸控裝置的雙擊手勢
  - 純前端實作，無需修改後端 API
**Scale/Scope**: 
  - 影響 4 個計畫面板（年/月/週/日）
  - 單一使用者操作，無並發問題
  - 前端程式碼新增約 150-200 行

## 憲法檢查

*閘門 (GATE): 必須在 Phase 0 研究前通過。Phase 1 設計後重新檢查。*

### I. 程式碼品質優先 ✅

- **PEP 8 / ES6+ 標準**: ✅ 新增的 JavaScript 程式碼將遵循 ES6+ 現代標準
- **函數複雜度 ≤ 15**: ✅ 雙擊事件處理和 CSS 類別切換邏輯簡單直接
- **函數長度 ≤ 50 行**: ✅ 預計每個函數約 15-30 行
- **有意義的命名**: ✅ 使用描述性名稱如 `toggleMaximize()`, `isMaximized`, `maximizedPanel`
- **無程式碼重複**: ✅ 共用邏輯將提取為可重用函數
- **JSDoc 註解**: ✅ 所有公開方法將包含 JSDoc 文件
- **移除無用程式碼**: ✅ 無新增無用程式碼

**狀態**: 通過 ✅

### II. 測試標準 ⚠️

- **Contract tests**: N/A (純前端功能，無 API 變更)
- **Integration tests**: ⚠️ 前端整合測試 - 本功能將透過手動測試驗證
- **Unit tests**: ⚠️ 前端單元測試 - 目前專案無前端測試框架
- **Edge case tests**: ⚠️ 將透過手動測試驗證邊界情況（快速連續點擊、視窗縮放等）

**狀態**: 部分通過 ⚠️  
**理由**: 目前專案無前端自動化測試框架。本功能將透過完整的手動測試來驗證所有使用者故事和邊界情況。未來若引入前端測試框架（如 Jest），應補充自動化測試。

### III. 使用者體驗一致性 ✅

- **即時視覺回饋**: ✅ 雙擊後立即觸發動畫轉場
- **友善錯誤訊息**: ✅ 無錯誤情境（功能容錯設計）
- **鍵盤快捷鍵**: ✅ 保持與現有快捷鍵相容，不引入新快捷鍵
- **響應式設計**: ✅ 支援桌面、平板、手機裝置
- **無障礙標籤**: ✅ 標題列將保留現有 ARIA 屬性，新增 tooltip 說明
- **載入狀態**: N/A (純 UI 切換，無需載入)
- **一致性**: ✅ 動畫風格與現有面板摺疊功能一致

**狀態**: 通過 ✅

### IV. 效能要求 ✅

- **API 響應時間**: N/A (無 API 呼叫)
- **前端渲染**: ✅ CSS transition 動畫 < 300ms，符合 < 500ms 導航要求
- **Markdown 渲染**: ✅ 不影響現有渲染邏輯
- **並發處理**: N/A (單一使用者前端操作)
- **非同步模式**: ✅ 事件處理使用非阻塞模式
- **記憶體使用**: ✅ 僅新增少量狀態變數（< 1KB）
- **無記憶體洩漏**: ✅ 正確移除事件監聽器，無洩漏風險

**狀態**: 通過 ✅

### V. 語言標準化 ✅

- **規格文件**: ✅ 使用繁體中文撰寫
- **實作計畫**: ✅ 使用繁體中文撰寫
- **程式碼註解**: ✅ 業務邏輯註解將使用繁體中文
- **UI 文字**: ✅ Tooltip 說明使用繁體中文（「再次雙擊以恢復正常檢視」）
- **變數名稱**: ✅ 使用英文（`isMaximized`, `maximizedPanel`）
- **Git commits**: ✅ 使用英文

**狀態**: 通過 ✅

### 總結

**通過閘門**: ✅ 是  
**例外事項**: 前端測試標準 - 將透過完整手動測試驗證，詳見複雜度追蹤章節。

## 專案結構

### 本功能文件

```text
specs/001-panel-maximize/
├── plan.md              # 本文件 (/speckit.plan 命令輸出)
├── spec.md              # 功能規格
├── research.md          # Phase 0 輸出
├── data-model.md        # Phase 1 輸出
├── quickstart.md        # Phase 1 輸出
├── contracts/           # Phase 1 輸出 (本功能無 API 合約)
└── checklists/          # 品質檢查表
    └── requirements.md  # 規格品質檢查表
```

### 原始碼（儲存庫根目錄）

```text
# Web 應用程式結構 (frontend + backend)
backend/
├── __init__.py
├── main.py              # FastAPI 應用程式主檔（無修改）
├── models.py            # Pydantic 模型（無修改）
├── plan_service.py      # 計畫服務（無修改）
├── date_calculator.py   # 日期計算工具（無修改）
└── settings_service.py  # 設定服務（無修改）

frontend/
└── index.html           # 主頁面（無修改）

static/
├── css/
│   └── main.css         # 【修改】新增 .panel-maximized 相關樣式
└── js/
    ├── plan-panel.js    # 【修改】新增 toggleMaximize() 方法和雙擊事件
    ├── layout-manager.js # 【修改】新增 maximizePanel() 和 restoreNormalView()
    ├── app.js           # 【修改】初始化最大化管理器
    ├── utils.js         # （可能新增）雙擊檢測工具函數
    ├── api.js           # （無修改）
    ├── date-picker.js   # （無修改）
    ├── markdown-editor.js # （無修改）
    ├── settings-manager.js # （無修改）
    ├── settings-modal.js # （無修改）
    └── about-modal.js   # （無修改）

# 無測試檔案變更（本功能純前端，手動測試）
```

**結構決策**: 本專案採用 Web 應用程式結構，前端和後端分離。本功能僅修改前端檔案（`static/css/main.css`, `static/js/plan-panel.js`, `static/js/layout-manager.js`, `static/js/app.js`），完全不影響後端。這符合最小變更原則，降低風險並便於回退。

## 複雜度追蹤

> **僅在憲法檢查有需要證明的違規時填寫**

| 違規項目 | 為何需要 | 拒絕的簡單替代方案及原因 |
|---------|---------|------------------------|
| 前端測試標準（無自動化測試） | 目前專案無前端測試框架（Jest, Mocha 等），建立測試基礎設施的成本超過本功能範圍 | 不引入測試框架：本功能範圍小且邏輯簡單，透過完整的手動測試（涵蓋所有使用者故事和邊界情況）可充分驗證正確性。未來若專案規模擴大，應考慮引入前端測試框架。 |

### 手動測試計畫

由於無自動化測試，將執行以下完整手動測試：

#### 功能測試（對應使用者故事）
1. **P1 - 單一面板放大檢視**
   - 測試每個面板（年/月/週/日）的雙擊最大化
   - 測試最大化後再次雙擊恢復
   - 驗證其他面板是否正確隱藏

2. **P2 - 最大化狀態視覺提示**
   - 檢查最大化面板的視覺樣式變化
   - 驗證 tooltip 顯示「再次雙擊以恢復正常檢視」
   - 確認滑鼠游標樣式為 pointer

3. **P3 - 保留面板功能狀態**
   - 在編輯模式下最大化/恢復，驗證未儲存內容保留
   - 測試捲動位置保留
   - 測試編輯/預覽模式保留
   - 測試摺疊狀態與最大化功能的互動

#### 邊界情況測試
1. 快速連續雙擊（5 次點擊在 1 秒內）- 檢查無閃爍或錯誤
2. 視窗縮放時面板處於最大化狀態 - 驗證適應新尺寸
3. 最大化時使用 Ctrl+\\ 切換左側面板 - 驗證行為一致性
4. 觸控裝置雙擊（平板/手機）- 驗證觸控手勢支援
5. 空面板或載入失敗時 - 驗證最大化功能仍可用

#### 跨裝置測試
1. 桌面瀏覽器（Chrome, Firefox, Safari, Edge）
2. 平板（iPad, Android tablet）
3. 手機（iOS, Android）

#### 效能測試
1. 測量雙擊到視覺變化完成的時間（目標 < 200ms）
2. 檢查動畫流暢度（目標 ≥ 50fps）
3. 長時間使用後檢查無記憶體洩漏

### 風險緩解

**風險**: 無自動化測試可能導致未來重構時迴歸錯誤  
**緩解措施**:
1. 詳細記錄手動測試結果
2. 建立測試檢查表（checklist）供未來回歸測試使用
3. 程式碼審查時特別注意邊界情況處理
4. 考慮在未來專案迭代中引入前端測試框架
