# Feature Specification: 資料匯出匯入功能

**Feature Branch**: `001-data-export-import`  
**Created**: 2025-10-25  
**Status**: Draft  
**Input**: 為原本程式增添功能:在 "應用程式設定" 的地方,增添可以匯出、匯入、data 的功能。匯出的 data 為所有 backend/data 目錄,壓縮而成的zip檔案,供使用者下載,壓縮的下載檔名 default 為 export_data_{YYYYMMDD_HHMMSS}.zip。同樣的壓縮格式,可匯入自己的工作計畫到資料表裡,並且檢查匯入格式當中 Day Month Week Year 當中若是有與原本格式不符合的地方(YYYYMMDD.md) 的命名方式,並且周計畫若不是禮拜天日期的話,都先提出警示,不要直接匯入。

## User Scenarios & Testing *(mandatory)*

### User Story 1 - 匯出工作計畫資料 (Priority: P1)

使用者想要備份自己的所有工作計畫資料,在應用程式設定頁面點擊匯出按鈕,系統將所有計畫資料打包成 ZIP 檔案供下載。

**Why this priority**: 這是核心功能,讓使用者能夠保存自己的資料,是資料主權和安全性的基礎需求。

**Independent Test**: 使用者可以點擊設定頁面的匯出按鈕,下載包含所有計畫資料的 ZIP 檔案,解壓縮後驗證資料完整性。

**Acceptance Scenarios**:

1. **Given** 使用者在應用程式設定頁面, **When** 點擊「匯出資料」按鈕, **Then** 瀏覽器開始下載一個命名為 `export_data_{YYYYMMDD_HHMMSS}.zip` 的檔案
2. **Given** 使用者下載了匯出的 ZIP 檔案, **When** 解壓縮該檔案, **Then** 可以看到完整的 Day、Month、Week、Year 資料夾結構及所有 markdown 檔案
3. **Given** 系統有 100 個計畫檔案, **When** 執行匯出, **Then** ZIP 檔案中應包含所有 100 個檔案且內容完整無誤

---

### User Story 2 - 匯入工作計畫資料前的格式驗證 (Priority: P1)

使用者上傳之前匯出的 ZIP 檔案或其他來源的資料包,系統需要先驗證檔案格式是否符合規範,在發現問題時提出警示,讓使用者決定是否繼續。

**Why this priority**: 資料驗證是保護系統完整性的關鍵,避免錯誤資料破壞現有計畫。與匯出功能同等重要。

**Independent Test**: 準備包含格式錯誤的 ZIP 檔案(例如檔名不符合 YYYYMMDD.md 格式),上傳後系統應顯示具體的錯誤警示訊息。

**Acceptance Scenarios**:

1. **Given** 使用者選擇了一個 ZIP 檔案進行匯入, **When** ZIP 中包含檔名不符合 `YYYYMMDD.md` 格式的檔案, **Then** 系統顯示警示訊息列出所有格式錯誤的檔案名稱,並阻止匯入
2. **Given** 使用者選擇了一個 ZIP 檔案進行匯入, **When** Week 資料夾中包含非星期日日期的檔案(例如 `20251020.md` 而 2025/10/20 是星期一), **Then** 系統顯示警示訊息指出哪些周計畫檔案的日期不是星期日,並阻止匯入
3. **Given** 使用者選擇了一個 ZIP 檔案進行匯入, **When** 檔案格式完全正確, **Then** 系統顯示「驗證通過」訊息並詢問使用者確認是否匯入

---

### User Story 3 - 確認並執行資料匯入 (Priority: P2)

當資料驗證通過後,使用者確認要匯入資料,系統將上傳的資料合併或覆蓋到現有的工作計畫中。

**Why this priority**: 這是完成資料還原的最後步驟,重要但需建立在驗證功能之上。

**Independent Test**: 準備一個格式正確的 ZIP 檔案,上傳並確認匯入後,在應用程式中能看到新匯入的計畫資料。

**Acceptance Scenarios**:

1. **Given** 資料驗證通過, **When** 使用者點擊「確認匯入」按鈕, **Then** 系統將 ZIP 檔案中的資料寫入 backend/data 目錄,並顯示匯入成功訊息
2. **Given** 匯入的資料中有與現有檔案同名的檔案, **When** 執行匯入, **Then** 系統直接以匯入的檔案覆蓋現有檔案,並在確認對話框中提醒使用者可能會覆蓋現有資料,建議先匯出備份
3. **Given** 匯入過程中發生錯誤(如磁碟空間不足), **When** 匯入失敗, **Then** 系統回滾所有變更,保持原有資料不變,並顯示錯誤訊息

---

### User Story 4 - 匯入後資料驗證 (Priority: P3)

匯入完成後,使用者可以在應用程式中檢視新匯入的計畫,確認資料正確顯示。

**Why this priority**: 提升使用者體驗,但不影響核心匯入功能。

**Independent Test**: 匯入包含特定日期計畫的 ZIP 檔案後,切換到該日期檢查計畫內容是否正確顯示。

**Acceptance Scenarios**:

1. **Given** 使用者剛完成資料匯入, **When** 導航到任一匯入的計畫日期, **Then** 可以看到該日期的完整計畫內容
2. **Given** 匯入了 20 個新的月計畫, **When** 切換月份檢視, **Then** 所有匯入的月份都能正確顯示

---

### Edge Cases

- 當 ZIP 檔案大小超過 100MB 時會發生什麼?(檔案上傳限制)
- 如果 ZIP 檔案結構完全錯誤(例如缺少 Day/Month/Week/Year 資料夾)怎麼辦?
- 如果檔案名稱是 `20251301.md`(不存在的日期)應該如何處理?
- 如果同時有多個使用者在不同裝置匯入資料會發生什麼?
- 匯出時如果 backend/data 目錄為空或不存在應如何處理?
- 如果使用者在匯入過程中取消操作,是否會留下部分匯入的資料?
- 如果 ZIP 檔案中包含隱藏檔案或系統檔案(如 `.DS_Store`)應該如何處理?

## Requirements *(mandatory)*

### Functional Requirements

- **FR-001**: 系統必須在應用程式設定頁面提供「匯出資料」按鈕
- **FR-002**: 系統必須將 `backend/data` 目錄下所有內容(包含 Day、Month、Week、Year 子目錄及所有檔案)壓縮為 ZIP 格式
- **FR-003**: 匯出的 ZIP 檔案名稱必須遵循格式 `export_data_{YYYYMMDD_HHMMSS}.zip`,其中時間戳使用匯出當下的本地時間
- **FR-004**: 系統必須在應用程式設定頁面提供「匯入資料」功能,允許使用者上傳 ZIP 檔案
- **FR-005**: 系統必須驗證上傳的 ZIP 檔案結構是否包含 Day、Month、Week、Year 資料夾
- **FR-006**: 系統必須驗證所有資料檔案的檔名是否符合 `YYYYMMDD.md` 格式(日計畫)或 `YYYYMM.md` 格式(月計畫)或 `YYYY.md` 格式(年計畫)
- **FR-007**: 系統必須驗證 Week 資料夾中的所有檔案,檢查檔名日期是否為星期日
- **FR-008**: 當發現格式錯誤時,系統必須顯示詳細的錯誤清單,包括具體的檔案名稱和錯誤類型
- **FR-009**: 當驗證發現錯誤時,系統必須阻止匯入動作,不允許部分匯入
- **FR-010**: 當驗證通過時,系統必須顯示確認對話框讓使用者最終確認是否執行匯入,並提醒若有同名檔案將會被覆蓋,建議先匯出備份
- **FR-011**: 匯入時若遇到同名檔案,系統必須直接以匯入的檔案覆蓋現有檔案
- **FR-012**: 匯入成功後,系統必須顯示成功訊息並提示使用者重新整理頁面以查看新資料
- **FR-012**: 匯入失敗時,系統必須回滾所有變更,確保資料一致性
- **FR-013**: 系統必須記錄所有匯出和匯入操作的日誌,包含時間戳和操作結果

### Key Entities

- **匯出檔案(Export Archive)**: 包含所有工作計畫資料的 ZIP 壓縮檔
  - 檔案名稱: 包含時間戳的唯一識別
  - 內容結構: Day/Month/Week/Year 目錄及所有 .md 檔案
  - 大小: 依使用者資料量而定

- **驗證報告(Validation Report)**: 匯入前的檔案格式檢查結果
  - 錯誤清單: 不符合格式的檔案名稱及錯誤類型
  - 警示訊息: 周計畫非星期日日期的檔案
  - 驗證狀態: 通過/失敗

- **工作計畫檔案(Plan File)**: 個別的 markdown 計畫檔案
  - 檔案類型: 日計畫/周計畫/月計畫/年計畫
  - 檔名格式: 日期格式編碼
  - 所屬目錄: Day/Week/Month/Year

## Success Criteria *(mandatory)*

### Measurable Outcomes

- **SC-001**: 使用者能在 3 秒內開始下載匯出的資料檔案
- **SC-002**: 匯出的 ZIP 檔案包含 100% 的原始資料,無任何遺漏
- **SC-003**: 系統能在 5 秒內完成格式驗證並回報結果(針對包含 1000 個檔案的 ZIP)
- **SC-004**: 格式驗證的準確率達到 100%,不會誤判正確格式為錯誤,也不會漏檢錯誤格式
- **SC-005**: 95% 的使用者能在首次嘗試時成功完成資料匯出和匯入流程
- **SC-006**: 匯入操作失敗時,100% 的情況下能完整回滾,不留下任何殘留資料
