<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è¨­å®šæ¸¬è©¦é é¢ - å·¥ä½œè¨ˆç•«æ—¥æ›†ç³»çµ±</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 p-8">
    <div class="max-w-4xl mx-auto">
        <h1 class="text-3xl font-bold mb-6 text-gray-800">è¨­å®šæ¸¬è©¦é é¢</h1>
        <p class="text-gray-600 mb-8">æ­¤é é¢å¹«åŠ©æ‚¨å¿«é€Ÿåˆ‡æ›ä¸åŒçš„é¢æ¿é¡¯ç¤ºè¨­å®šï¼Œæ–¹ä¾¿æˆªåœ–å±•ç¤ºå„ç¨®ç‹€æ…‹ã€‚</p>
        
        <!-- ç•¶å‰è¨­å®šé¡¯ç¤º -->
        <div id="current-settings" class="bg-white p-6 rounded-lg shadow-md mb-8">
            <h2 class="text-xl font-semibold mb-4">ç•¶å‰è¨­å®šç‹€æ…‹</h2>
            <div id="settings-display" class="text-sm">è¼‰å…¥ä¸­...</div>
        </div>

        <!-- é è¨­è¨­å®šæŒ‰éˆ• -->
        <div class="bg-white p-6 rounded-lg shadow-md mb-8">
            <h2 class="text-xl font-semibold mb-4">å¿«é€Ÿè¨­å®š</h2>
            <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                <button onclick="applyPreset('all_visible')" 
                        class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded transition-colors">
                    å…¨éƒ¨é¡¯ç¤º
                </button>
                <button onclick="applyPreset('minimal')" 
                        class="bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded transition-colors">
                    æœ€å°é¡¯ç¤º
                </button>
                <button onclick="applyPreset('current_only')" 
                        class="bg-orange-500 hover:bg-orange-600 text-white px-4 py-2 rounded transition-colors">
                    åƒ…ç•¶æœŸé¢æ¿
                </button>
                <button onclick="applyPreset('history_only')" 
                        class="bg-purple-500 hover:bg-purple-600 text-white px-4 py-2 rounded transition-colors">
                    åƒ…æ­·å²é¢æ¿
                </button>
                <button onclick="applyPreset('year_month_only')" 
                        class="bg-indigo-500 hover:bg-indigo-600 text-white px-4 py-2 rounded transition-colors">
                    åªé¡¯ç¤ºå¹´æœˆ
                </button>
                <button onclick="applyPreset('week_day_only')" 
                        class="bg-teal-500 hover:bg-teal-600 text-white px-4 py-2 rounded transition-colors">
                    åªé¡¯ç¤ºé€±æ—¥
                </button>
                <button onclick="applyPreset('left_minimal')" 
                        class="bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded transition-colors">
                    å·¦å´æœ€å°
                </button>
                <button onclick="applyPreset('right_minimal')" 
                        class="bg-yellow-500 hover:bg-yellow-600 text-white px-4 py-2 rounded transition-colors">
                    å³å´æœ€å°
                </button>
            </div>
        </div>

        <!-- æ“ä½œæŒ‰éˆ• -->
        <div class="bg-white p-6 rounded-lg shadow-md mb-8">
            <h2 class="text-xl font-semibold mb-4">æ“ä½œ</h2>
            <div class="flex flex-wrap gap-4">
                <button onclick="loadCurrentSettings()" 
                        class="bg-gray-500 hover:bg-gray-600 text-white px-4 py-2 rounded transition-colors">
                    ğŸ”„ é‡æ–°è¼‰å…¥è¨­å®š
                </button>
                <button onclick="resetToDefault()" 
                        class="bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded transition-colors">
                    â†©ï¸ é‡è¨­ç‚ºé è¨­å€¼
                </button>
                <a href="/" 
                   class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded transition-colors inline-block">
                    ğŸ  å›åˆ°ä¸»é é¢
                </a>
                <button onclick="openMainInNewTab()" 
                        class="bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded transition-colors">
                    ğŸ“‚ æ–°é ç±¤é–‹å•Ÿä¸»é 
                </button>
            </div>
        </div>

        <!-- ç‹€æ…‹è¨Šæ¯ -->
        <div id="message" class="hidden p-4 rounded-lg mb-4"></div>

        <!-- æˆªåœ–å»ºè­° -->
        <div class="bg-yellow-50 border-l-4 border-yellow-400 p-6 rounded-r-lg">
            <h3 class="text-lg font-semibold mb-2 text-yellow-800">ğŸ“¸ æˆªåœ–å»ºè­°</h3>
            <ol class="list-decimal list-inside text-yellow-700 space-y-1">
                <li>é»æ“Šä¸Šæ–¹çš„è¨­å®šæŒ‰éˆ•å¥—ç”¨ä¸åŒç‹€æ…‹</li>
                <li>ç­‰å¾… 2 ç§’é˜è®“è¨­å®šå®Œå…¨å¥—ç”¨</li>
                <li>é»æ“Šã€Œæ–°é ç±¤é–‹å•Ÿä¸»é ã€æˆ–ç›´æ¥å‰å¾€ä¸»é é¢</li>
                <li>æˆªåœ–ä¸»ç•Œé¢ï¼Œå±•ç¤ºä¸åŒçš„é¢æ¿é¡¯ç¤ºæ•ˆæœ</li>
                <li>é‡è¤‡ä»¥ä¸Šæ­¥é©Ÿæ¸¬è©¦ä¸åŒè¨­å®šçµ„åˆ</li>
            </ol>
        </div>
    </div>

    <script>
        // é è¨­è¨­å®šçµ„åˆ
        const presets = {
            all_visible: {
                panels: {
                    left: { year: true, month: true, week: true, day: true },
                    right: { year: true, month: true, week: true, day: true }
                }
            },
            minimal: {
                panels: {
                    left: { year: false, month: false, week: true, day: true },
                    right: { year: false, month: false, week: true, day: true }
                }
            },
            current_only: {
                panels: {
                    left: { year: false, month: false, week: false, day: false },
                    right: { year: true, month: true, week: true, day: true }
                }
            },
            history_only: {
                panels: {
                    left: { year: true, month: true, week: true, day: true },
                    right: { year: false, month: false, week: false, day: false }
                }
            },
            year_month_only: {
                panels: {
                    left: { year: true, month: true, week: false, day: false },
                    right: { year: true, month: true, week: false, day: false }
                }
            },
            week_day_only: {
                panels: {
                    left: { year: false, month: false, week: true, day: true },
                    right: { year: false, month: false, week: true, day: true }
                }
            },
            left_minimal: {
                panels: {
                    left: { year: false, month: false, week: false, day: true },
                    right: { year: true, month: true, week: true, day: true }
                }
            },
            right_minimal: {
                panels: {
                    left: { year: true, month: true, week: true, day: true },
                    right: { year: false, month: false, week: false, day: true }
                }
            }
        };

        // é¡¯ç¤ºè¨Šæ¯
        function showMessage(text, type = 'info') {
            const messageEl = document.getElementById('message');
            messageEl.className = `p-4 rounded-lg mb-4 ${
                type === 'success' ? 'bg-green-100 text-green-700 border border-green-200' :
                type === 'error' ? 'bg-red-100 text-red-700 border border-red-200' :
                'bg-blue-100 text-blue-700 border border-blue-200'
            }`;
            messageEl.textContent = text;
            messageEl.classList.remove('hidden');
            
            setTimeout(() => {
                messageEl.classList.add('hidden');
            }, 3000);
        }

        // å¥—ç”¨é è¨­è¨­å®š
        async function applyPreset(presetName) {
            if (!presets[presetName]) {
                showMessage('æœªçŸ¥çš„é è¨­è¨­å®š', 'error');
                return;
            }

            try {
                showMessage('æ­£åœ¨å¥—ç”¨è¨­å®š...', 'info');
                
                const response = await fetch('/api/settings/ui', {
                    method: 'PUT',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(presets[presetName])
                });

                if (response.ok) {
                    showMessage('è¨­å®šå·²æˆåŠŸå¥—ç”¨ï¼', 'success');
                    await loadCurrentSettings();
                } else {
                    throw new Error(`HTTP ${response.status}`);
                }
            } catch (error) {
                showMessage(`å¥—ç”¨è¨­å®šå¤±æ•—: ${error.message}`, 'error');
            }
        }

        // è¼‰å…¥ç•¶å‰è¨­å®š
        async function loadCurrentSettings() {
            try {
                const response = await fetch('/api/settings/ui');
                if (response.ok) {
                    const settings = await response.json();
                    displaySettings(settings);
                } else {
                    throw new Error(`HTTP ${response.status}`);
                }
            } catch (error) {
                document.getElementById('settings-display').innerHTML = 
                    `<span class="text-red-600">è¼‰å…¥å¤±æ•—: ${error.message}</span>`;
            }
        }

        // é¡¯ç¤ºè¨­å®šç‹€æ…‹
        function displaySettings(settings) {
            const html = `
                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <h4 class="font-semibold text-gray-700 mb-2">å·¦å´é¢æ¿ (æ­·å²è¨ˆç•«)</h4>
                        <ul class="space-y-1 text-sm">
                            <li>å¹´è¨ˆç•«: ${settings.panels.left.year ? 'âœ… é¡¯ç¤º' : 'âŒ éš±è—'}</li>
                            <li>æœˆè¨ˆç•«: ${settings.panels.left.month ? 'âœ… é¡¯ç¤º' : 'âŒ éš±è—'}</li>
                            <li>é€±è¨ˆç•«: ${settings.panels.left.week ? 'âœ… é¡¯ç¤º' : 'âŒ éš±è—'}</li>
                            <li>æ—¥è¨ˆç•«: ${settings.panels.left.day ? 'âœ… é¡¯ç¤º' : 'âŒ éš±è—'}</li>
                        </ul>
                    </div>
                    <div>
                        <h4 class="font-semibold text-gray-700 mb-2">å³å´é¢æ¿ (ç•¶æœŸè¨ˆç•«)</h4>
                        <ul class="space-y-1 text-sm">
                            <li>å¹´è¨ˆç•«: ${settings.panels.right.year ? 'âœ… é¡¯ç¤º' : 'âŒ éš±è—'}</li>
                            <li>æœˆè¨ˆç•«: ${settings.panels.right.month ? 'âœ… é¡¯ç¤º' : 'âŒ éš±è—'}</li>
                            <li>é€±è¨ˆç•«: ${settings.panels.right.week ? 'âœ… é¡¯ç¤º' : 'âŒ éš±è—'}</li>
                            <li>æ—¥è¨ˆç•«: ${settings.panels.right.day ? 'âœ… é¡¯ç¤º' : 'âŒ éš±è—'}</li>
                        </ul>
                    </div>
                </div>
            `;
            document.getElementById('settings-display').innerHTML = html;
        }

        // é‡è¨­ç‚ºé è¨­å€¼
        async function resetToDefault() {
            if (!confirm('ç¢ºå®šè¦é‡è¨­æ‰€æœ‰è¨­å®šç‚ºé è¨­å€¼å—ï¼Ÿ')) {
                return;
            }

            try {
                showMessage('æ­£åœ¨é‡è¨­è¨­å®š...', 'info');
                
                const response = await fetch('/api/settings/reset', {
                    method: 'POST'
                });

                if (response.ok) {
                    showMessage('è¨­å®šå·²é‡è¨­ç‚ºé è¨­å€¼ï¼', 'success');
                    await loadCurrentSettings();
                } else {
                    throw new Error(`HTTP ${response.status}`);
                }
            } catch (error) {
                showMessage(`é‡è¨­å¤±æ•—: ${error.message}`, 'error');
            }
        }

        // åœ¨æ–°é ç±¤é–‹å•Ÿä¸»é é¢
        function openMainInNewTab() {
            window.open('/', '_blank');
        }

        // é é¢è¼‰å…¥æ™‚è‡ªå‹•è¼‰å…¥ç•¶å‰è¨­å®š
        document.addEventListener('DOMContentLoaded', loadCurrentSettings);
    </script>
</body>
</html>